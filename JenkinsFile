pipeline {
    agent any
    tools {
        nodejs 'nodejs-20.14.0' // Replace with the name of your Node.js installation in Jenkins
    }

    environment {
        NODEJS_HOME = 'C:/Program Files/nodejs' // Path to Node.js installation
        SONAR_SCANNER_PATH = 'D:/Worldline Classes/sonar-scanner-6.2.1.4610-windows-x64/bin' // Path to Sonar Scanner
    }

    stages {
        stage('Clone Repository') {
            steps {
                git 'https://github.com/HemantModi11/SonarQube-Assignment.git' // Replace with your repository URL
            }
        }

        stage('Install Dependencies') {
            steps {
                bat '''
                set PATH=%NODEJS_HOME%;%PATH%
                npm install
                '''
            }
        }

        stage('Run SonarQube Analysis') {
            environment {
                SONAR_TOKEN = credentials('assignment2-token') // Replace with your SonarQube token credential ID
            }
            steps {
                bat '''
                set PATH=%SONAR_SCANNER_PATH%;%PATH%
                sonar-scanner -Dsonar.projectKey=SonarQubeAssignment ^ 
                    -Dsonar.sources=. ^ 
                    -Dsonar.host.url=http://192.168.29.98:9000 ^ 
                    -Dsonar.token=%SONAR_TOKEN% 2>&1
                '''
            }
        }
    }

    post {
        success {
            echo 'Pipeline completed successfully.'
        }
        failure {
            echo 'Pipeline failed. Check logs for details.'
        }
        always {
            echo 'Pipeline execution finished.'
        }
    }
}
